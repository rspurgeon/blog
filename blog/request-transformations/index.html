<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Adding attributes to HTTP requests with Kong Gateway | Developing Ideas</title><meta name=keywords content><meta name=description content="A no-code solution to modifying requests for your APIs"><meta name=author content="Rick Spurgeon (rick.spurgeon@konghq.com)"><link rel=canonical href=https://blog.spurgeon.dev/blog/request-transformations/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.spurgeon.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.spurgeon.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.spurgeon.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.spurgeon.dev/apple-touch-icon.png><link rel=mask-icon href=https://blog.spurgeon.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Adding attributes to HTTP requests with Kong Gateway"><meta property="og:description" content="A no-code solution to modifying requests for your APIs"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.spurgeon.dev/blog/request-transformations/"><meta property="article:section" content="blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Adding attributes to HTTP requests with Kong Gateway"><meta name=twitter:description content="A no-code solution to modifying requests for your APIs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://blog.spurgeon.dev/blog/"},{"@type":"ListItem","position":2,"name":"Adding attributes to HTTP requests with Kong Gateway","item":"https://blog.spurgeon.dev/blog/request-transformations/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Adding attributes to HTTP requests with Kong Gateway","name":"Adding attributes to HTTP requests with Kong Gateway","description":"A no-code solution to modifying requests for your APIs","keywords":[],"articleBody":"It’s very common to have an HTTP service which accepts requests expecting a JSON document in the body. Let’s assume that the development team of your service plans to change the request API in the near future, and will eventually begin to require a new field in the JSON body of the requests. Eventually your client applications will need to upgrade their requests to support this new value, but how could you provide a default value for your services in the meantime?\nKong Gateway supports a Plugin architecture including a Request Transfomer Plugin that can modify incoming requests before proxying them to your upstream service. This can all be accomplished using a no-code solution and managed with no downtime using Kong’s dynamic administrative capabilities.\nThis guide will show you how to configure the Request Transformer plugin using the Kong Admin API to modify incoming requests with a static constant value. Then we will test the feature with a mock request verfying the transformation process.\nPrerequisites The guide assumes the following:\nYou have a Kong Gateway available for testing and is reachable on localhost. If you would like help running a local gateway using Docker, see this companion Kong Gateway in minutes guide. If your gateway is available on a different host, adjust the commands in this guide appropriately. You have a service named mock installed on your gateway. You can adjust the commands to use a different service or use the Kong Gateway in minutes guide to run a gateway with a mock service. You have curl installed on your system, which is used to send requests to the gateway. Most systems come with curl pre-installed. This guide uses the jq command line JSON processing tool. While this tool is not necessary to complete the tasks, it’s helpful for processing JSON responses from the gateway. If you do not have jq or do not wish to install it, you can modify the commands to remove jq processing. Steps There are a large number of Kong plugins, many of which need to be custom installed prior to utilization. Fortunately, Kong ships prepackaged with a number of useful plugins including the Request Transformer.\nFirst verify the Request Transformer plugin is available on your gateway by querying the Admin API and using jq to filter the response looking at the plugins available on the server.\ncurl -s http://localhost:8001 | \\ jq -r '.plugins.available_on_server.\"request-transformer\"' The command output should be:\ntrue Now, assign a new instance of the Request Transformer plugin to the mock service by invoking the following POST request to the Admin API. In this command, the config.add.body value instructions the plugin to add a new field to the body of incoming requests before forwarding to the mock service. In this example, we are adding a field named new-field, and giving it a static value of defaultValue.\ncurl -i -X POST http://localhost:8001/services/mock/plugins \\ --data \"name=request-transformer\" \\ --data \"config.add.body=new-field:defaultValue\" The result of that command should be a successful 201 Created HTTP response code with a JSON body including information about the new plugin instance.\nThe Request Transformer provides the ability to perform much more complex transformations, see the full documentation for more detail.\nNext, we can use the mock service’s /requests endpoint to test the behavior of the plugin. The /requests API will echo back valuable information from the request we make to it including headers and the request body we send.\ncurl -s -XPOST http://localhost:8000/mock/requests \\ -H 'Content-Type: application/json' \\ -d '{\"existing-field\": \"abc123\"}' What you should notice in the JSON response is the postData value which includes the JSON body sent to the service.\nHere is a command to use jq to fully extract just the request body echoed back from the mock service.\ncurl -s -XPOST http://localhost:8000/mock/requests \\ -H 'Content-Type: application/json' \\ -d '{\"existing-field\": \"Kong FTW!\"}' | \\ jq -r '.postData.text' Which should return the following, indicating new-field has been added to the sent request body.\n{\"existing-field\":\"Kong FTW!\",\"new-field\":\"defaultValue\"} What’s next? More advanced transformations can be accomplished with the Request Transformer Advanced plugin. If no standard plugin is available to satisfy your use case, the Plugin Development Guide can help you with developing your own plugin. ","wordCount":"693","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Rick Spurgeon (rick.spurgeon@konghq.com)"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.spurgeon.dev/blog/request-transformations/"},"publisher":{"@type":"Organization","name":"Developing Ideas","logo":{"@type":"ImageObject","url":"https://blog.spurgeon.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.spurgeon.dev/ accesskey=h title="Developing Ideas (Alt + H)">Developing Ideas</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Adding attributes to HTTP requests with Kong Gateway</h1><div class=post-description>A no-code solution to modifying requests for your APIs</div><div class=post-meta>4 min&nbsp;·&nbsp;Rick Spurgeon (rick.spurgeon@konghq.com)</div></header><div class=post-content><p>It&rsquo;s very common to have an HTTP service which accepts requests expecting a JSON document in the body.
Let&rsquo;s assume that the development team of your service plans to change the request API in the near future,
and will eventually begin to require a new field in the JSON body of the requests.
Eventually your client applications will need to upgrade their requests to support this new value,
but how could you provide a default value for your services in the meantime?</p><p><a href=https://docs.konghq.com/gateway/latest/>Kong Gateway</a> supports a <a href=https://docs.konghq.com/hub/>Plugin</a>
architecture including a <a href=https://docs.konghq.com/hub/kong-inc/request-transformer/>Request Transfomer Plugin</a>
that can modify incoming requests before proxying them to your upstream service.
This can all be accomplished using a no-code solution and managed with no downtime using
Kong&rsquo;s dynamic administrative capabilities.</p><p>This guide will show you how to configure the Request Transformer plugin using
the <a href=https://docs.konghq.com/gateway/latest/admin-api/>Kong Admin API</a> to modify incoming
requests with a static constant value. Then we will test the feature with a mock
request verfying the transformation process.</p><h3 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h3><p>The guide assumes the following:</p><ul><li>You have a Kong Gateway available for testing and is reachable on <code>localhost</code>.
If you would like help running a local gateway using Docker, see this companion
<a href=/blog/kong-in-minutes/>Kong Gateway in minutes</a> guide. If your gateway is available on
a different host, adjust the commands in this guide appropriately.</li><li>You have a service named <code>mock</code> installed on your gateway. You can adjust the
commands to use a different service or use the <a href=/blog/kong-in-minutes>Kong Gateway in minutes</a> guide to
run a gateway with a <code>mock</code> service.</li><li>You have <a href=https://curl.se/><code>curl</code></a> installed on your system, which is used to send
requests to the gateway. Most systems come with <code>curl</code> pre-installed.</li><li>This guide uses the <a href=https://stedolan.github.io/jq/><code>jq</code></a> command line JSON processing tool. While
this tool is not necessary to complete the tasks, it&rsquo;s helpful for processing JSON responses from
the gateway. If you do not have <code>jq</code> or do not wish to install it, you can modify the commands to remove
<code>jq</code> processing.</li></ul><h3 id=steps>Steps<a hidden class=anchor aria-hidden=true href=#steps>#</a></h3><p>There are a large number of Kong plugins, many of which need to
be <a href=https://docs.konghq.com/gateway/latest/plugin-development/distribution/>custom installed</a>
prior to utilization. Fortunately, Kong ships prepackaged with a number of useful plugins including
the Request Transformer.</p><p>First verify the Request Transformer plugin is available on your gateway by querying the Admin API and using <code>jq</code> to filter the response looking at the plugins available on the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -s http://localhost:8001 | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  jq -r <span style=color:#e6db74>&#39;.plugins.available_on_server.&#34;request-transformer&#34;&#39;</span>
</span></span></code></pre></div><p>The command output should be:</p><pre tabindex=0><code>true
</code></pre><p>Now, assign a new instance of the Request Transformer plugin to
the mock service by invoking the following <code>POST</code> request to the Admin API.
In this command, the <code>config.add.body</code> value instructions the plugin to add a new
field to the body of incoming requests before forwarding to the <code>mock</code> service.
In this example, we are adding a field named <code>new-field</code>, and giving it a static value of
<code>defaultValue</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -i -X POST http://localhost:8001/services/mock/plugins <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data <span style=color:#e6db74>&#34;name=request-transformer&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data <span style=color:#e6db74>&#34;config.add.body=new-field:defaultValue&#34;</span>
</span></span></code></pre></div><p>The result of that command should be a successful <code>201 Created</code> HTTP response code with a
JSON body including information about the new plugin instance.</p><p>The Request Transformer provides the ability to perform much more complex
transformations, see the
<a href=https://docs.konghq.com/hub/kong-inc/request-transformer/>full documentation</a> for more detail.</p><p>Next, we can use the <code>mock</code> service&rsquo;s <code>/requests</code> endpoint to test the behavior of the plugin.
The <code>/requests</code> API will echo back valuable information from the request we make to it including
headers and the request body we send.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -s -XPOST http://localhost:8000/mock/requests <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-d <span style=color:#e6db74>&#39;{&#34;existing-field&#34;: &#34;abc123&#34;}&#39;</span>
</span></span></code></pre></div><p>What you should notice in the JSON response is the <code>postData</code> value which includes the
JSON body sent to the service.</p><p>Here is a command to use <code>jq</code> to fully extract just the request body echoed back from the <code>mock</code> service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -s -XPOST http://localhost:8000/mock/requests <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-d <span style=color:#e6db74>&#39;{&#34;existing-field&#34;: &#34;Kong FTW!&#34;}&#39;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	jq -r <span style=color:#e6db74>&#39;.postData.text&#39;</span>
</span></span></code></pre></div><p>Which should return the following, indicating <code>new-field</code> has been added to the sent request body.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>{&#34;existing-field&#34;:&#34;Kong FTW!&#34;,&#34;new-field&#34;:&#34;defaultValue&#34;}
</span></span></code></pre></div><h3 id=whats-next>What&rsquo;s next?<a hidden class=anchor aria-hidden=true href=#whats-next>#</a></h3><ul><li>More advanced transformations can be accomplished with the
<a href=https://docs.konghq.com/hub/kong-inc/request-transformer-advanced/>Request Transformer Advanced</a>
plugin.</li><li>If no standard plugin is available to satisfy your use case, the
<a href=https://docs.konghq.com/gateway/latest/plugin-development/>Plugin Development Guide</a>
can help you with developing your own plugin.</li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.spurgeon.dev/>Developing Ideas</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>